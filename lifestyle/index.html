<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lifestyle Tracker App</title>

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Styles -->
  <style>
    body { background: #f7f8fb; font-family: 'Inter', sans-serif; }
    .glass { backdrop-filter: blur(15px); background: rgba(255,255,255,.7); border: 1px solid rgba(255,255,255,.5); box-shadow: 0 10px 30px rgba(2,6,23,.08); }
    .toggle-on { background: #10b981 !important; color: #fff !important; }
    .toggle-off { background: #e2e8f0 !important; color: #475569 !important; }
    /* Heartbeat line inside toggle buttons */
    .toggle-on, .toggle-off { position: relative; overflow: hidden; }
    .toggle-on .label, .toggle-off .label { position: relative; z-index: 3; padding: 2px 8px; border-radius: 9999px; }
    .toggle-on .label { background-color: #10b981; }
    .toggle-off .label { background-color: #e2e8f0; }
    .hb { position: absolute; left: 0; top: 50%; transform: translateY(-50%); width: 100%; height: 24px; z-index: 1; opacity: 0.9; pointer-events: none; }
    .hb path { fill: none; stroke-width: 2; stroke-linejoin: round; stroke-linecap: round; }
    /* Live (enabled) */
    .toggle-on .hb .hb-wave { stroke: rgba(255,255,255,0.95); stroke-dasharray: 70 180; animation: heartbeat 2s linear infinite; animation-delay: var(--hb-delay,0ms); filter: drop-shadow(0 0 6px rgba(255,255,255,.85)); }
    .toggle-on .hb .hb-flat { display: none; }
    /* Dead (disabled) */
    .toggle-off .hb .hb-flat { stroke: #64748b; opacity: .6; animation: flatpulse 2s ease-in-out infinite; animation-delay: var(--hb-delay,0ms); filter: drop-shadow(0 0 4px rgba(100,116,139,.5)); }
    .toggle-off .hb .hb-wave { display: none; }
    @keyframes heartbeat { from { stroke-dashoffset: 0; } to { stroke-dashoffset: -250; } }
    @keyframes flatpulse { 0%,100% { opacity: .35 } 50% { opacity: .6 } }
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(12px);} to { opacity: 1; transform: translateY(0);} }
    .animate-in { animation: fadeInUp .5s ease both; }
    @keyframes gradientX { 0% { background-position: 0% 50%; } 100% { background-position: 100% 50%; } }
    .btn-animated { background: linear-gradient(90deg,#3b82f6,#10b981,#8b5cf6); background-size:200% 100%; animation: gradientX 4s ease infinite alternate; color:#fff; }
  </style>

  <!-- PWA Manifest -->
  <link rel="manifest" href="pwa/manifest.json" />
  <!-- Chart.js for stats -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<script>
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("pwa/service-worker.js");
  }
</script>

<body class="min-h-screen flex flex-col">

  <!-- HEADER -->
  <header class="w-full py-4 text-white shadow btn-animated">
    <div class="max-w-5xl mx-auto px-4 flex items-center">
      <img src="assets/icon-192.png" alt="" class="w-8 h-8 rounded mr-3" />
      <h1 class="text-xl md:text-2xl font-semibold">Lifestyle Tracker</h1>
    </div>
  </header>

  <main class="flex-1 px-4 md:px-8 lg:px-12 py-8 space-y-10">

    <!-- MOTIVATIONAL QUOTE -->
    <section class="max-w-5xl mx-auto animate-in">
      <div class="glass rounded-2xl p-4 shadow text-center text-slate-700" id="quoteBox">Stay consistent ‚Äî small healthy choices add up.</div>
    </section>

    <!-- PROFILE + STATS -->
    <section class="max-w-5xl mx-auto animate-in">
      <div class="glass rounded-2xl p-4 shadow flex flex-col md:flex-row items-center gap-4">
        <div id="genderSketch" class="text-6xl select-none">üë§</div>
        <div class="flex-1 w-full">
          <div class="flex items-center justify-between">
            <h3 class="text-lg font-semibold text-gray-700">
              <span id="welcomeText">Welcome</span>
            </h3>
            <button id="editProfileBtn" class="px-3 py-2 rounded-lg border border-slate-200 bg-white hover:bg-slate-50 text-sm">Edit Profile</button>
          </div>
          <div class="mt-3">
            <div class="flex items-center gap-3">
              <label class="text-sm text-slate-600">Range</label>
              <select id="rangeSelect" class="px-3 py-2 rounded-lg border border-slate-300 bg-white text-sm">
                <option value="daily">Daily</option>
                <option value="weekly">Weekly</option>
                <option value="monthly">Monthly</option>
                <option value="all">All time</option>
              </select>
            </div>
            <div class="mt-3">
              <canvas id="alertChart" height="120"></canvas>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- REMINDER MODULES (kept from dashboard) -->
    <section class="max-w-5xl mx-auto animate-in">
      <h2 class="text-xl font-semibold text-gray-700 mb-4">Reminder Modules</h2>
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">

        <!-- Exercise -->
        <div class="glass p-4 rounded-xl shadow flex flex-col justify-between">
          <div class="flex items-center justify-between">
            <div>
              <h3 class="text-lg font-semibold text-gray-700">üèãÔ∏è Exercise</h3>
              <p class="text-gray-500 text-sm">Gym + mobility reminders</p>
            </div>
            <button aria-label="Edit times" title="Edit times" class="p-2 rounded-md bg-white border border-slate-200 shadow hover:bg-slate-50" onclick="openSettings('exercise')">
              <img src="assets/setting.png" alt="Settings" class="h-6 w-6 object-contain" />
            </button>
          </div>
          <div class="flex gap-2 mt-4">
            <button id="toggle-exercise" class="flex-1 py-2 rounded-lg toggle-off font-medium shadow">Enable</button>
            <button type="button" onclick="window.testWebhook('exercise')" class="px-3 py-2 rounded-lg shadow btn-animated">Test</button>
          </div>
        </div>

        <!-- Food -->
        <div class="glass p-4 rounded-xl shadow flex flex-col justify-between">
          <div class="flex items-center justify-between">
            <div>
              <h3 class="text-lg font-semibold text-gray-700">üçΩ Food</h3>
              <p class="text-gray-500 text-sm">Breakfast, lunch, dinner reminders</p>
            </div>
            <button aria-label="Edit times" title="Edit times" class="p-2 rounded-md bg-white border border-slate-200 shadow hover:bg-slate-50" onclick="openSettings('food')">
              <img src="assets/setting.png" alt="Settings" class="h-6 w-6 object-contain" />
            </button>
          </div>
          <div class="flex gap-2 mt-4">
            <button id="toggle-food" class="flex-1 py-2 rounded-lg toggle-off font-medium shadow">Enable</button>
            <button type="button" onclick="window.testWebhook('food')" class="px-3 py-2 rounded-lg shadow btn-animated">Test</button>
          </div>
        </div>

        <!-- Water -->
        <div class="glass p-4 rounded-xl shadow flex flex-col justify-between">
          <div class="flex items-center justify-between">
            <div>
              <h3 class="text-lg font-semibold text-gray-700">üíß Water</h3>
              <p class="text-gray-500 text-sm">Hydration reminders throughout day</p>
            </div>
            <button aria-label="Edit times" title="Edit times" class="p-2 rounded-md bg-white border border-slate-200 shadow hover:bg-slate-50" onclick="openSettings('water')">
              <img src="assets/setting.png" alt="Settings" class="h-6 w-6 object-contain" />
            </button>
          </div>
          <div class="flex gap-2 mt-4">
            <button id="toggle-water" class="flex-1 py-2 rounded-lg toggle-off font-medium shadow">Enable</button>
            <button type="button" onclick="window.testWebhook('water')" class="px-3 py-2 rounded-lg shadow btn-animated">Test</button>
          </div>
        </div>

        <!-- Work -->
        <div class="glass p-4 rounded-xl shadow flex flex-col justify-between">
          <div class="flex items-center justify-between">
            <div>
              <h3 class="text-lg font-semibold text-gray-700">üíª Work</h3>
              <p class="text-gray-500 text-sm">Productivity + focus reminders</p>
            </div>
            <button aria-label="Edit times" title="Edit times" class="p-2 rounded-md bg-white border border-slate-200 shadow hover:bg-slate-50" onclick="openSettings('work')">
              <img src="assets/setting.png" alt="Settings" class="h-6 w-6 object-contain" />
            </button>
          </div>
          <div class="flex gap-2 mt-4">
            <button id="toggle-work" class="flex-1 py-2 rounded-lg toggle-off font-medium shadow">Enable</button>
            <button type="button" onclick="window.testWebhook('work')" class="px-3 py-2 rounded-lg shadow btn-animated">Test</button>
          </div>
        </div>

        <!-- Sleep -->
        <div class="glass p-4 rounded-xl shadow flex flex-col justify-between">
          <div class="flex items-center justify-between">
            <div>
              <h3 class="text-lg font-semibold text-gray-700">üò¥ Sleep</h3>
              <p class="text-gray-500 text-sm">Sleep routine + wind-down reminders</p>
            </div>
            <button aria-label="Edit times" title="Edit times" class="p-2 rounded-md bg-white border border-slate-200 shadow hover:bg-slate-50" onclick="openSettings('sleep')">
              <img src="assets/setting.png" alt="Settings" class="h-6 w-6 object-contain" />
            </button>
          </div>
          <div class="flex gap-2 mt-4">
            <button id="toggle-sleep" class="flex-1 py-2 rounded-lg toggle-off font-medium shadow">Enable</button>
            <button type="button" onclick="window.testWebhook('sleep')" class="px-3 py-2 rounded-lg shadow btn-animated">Test</button>
          </div>
        </div>

      </div>
    </section>

  <!-- Settings Modal (per-module) -->
  <div id="settingsModal" class="fixed inset-0 z-50 hidden">
      <div class="absolute inset-0 bg-slate-900/40" onclick="closeSettings()"></div>
      <div class="relative max-w-xl mx-auto mt-24 glass rounded-2xl p-6 animate-in">
        <div class="flex items-center justify-between mb-3">
          <h3 id="modalTitle" class="text-lg font-semibold text-gray-800">Edit Times</h3>
          <button class="p-2 rounded-lg hover:bg-slate-100" onclick="closeSettings()">‚úñ</button>
  </div>

    <!-- Profile Modal -->
    <div id="profileModal" class="fixed inset-0 z-50 hidden">
      <div class="absolute inset-0 bg-slate-900/40" onclick="closeProfile()"></div>
      <div class="relative max-w-lg mx-auto mt-24 glass rounded-2xl p-6 animate-in">
        <h3 class="text-lg font-semibold text-gray-800 mb-4">Tell us about you</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="text-sm text-slate-600">Name</label>
            <input id="pf_name" type="text" class="w-full bg-white border border-slate-300 rounded-lg px-3 py-2" />
          </div>
          <div>
            <label class="text-sm text-slate-600">Birthdate</label>
            <input id="pf_birth" type="date" class="w-full bg-white border border-slate-300 rounded-lg px-3 py-2" />
          </div>
          <div>
            <label class="text-sm text-slate-600">Height (cm)</label>
            <input id="pf_height" type="number" min="0" class="w-full bg-white border border-slate-300 rounded-lg px-3 py-2" />
          </div>
          <div>
            <label class="text-sm text-slate-600">Weight (kg)</label>
            <input id="pf_weight" type="number" min="0" class="w-full bg-white border border-slate-300 rounded-lg px-3 py-2" />
          </div>
          <div class="md:col-span-2">
            <label class="text-sm text-slate-600">Gender</label>
            <div class="mt-1 flex items-center gap-4">
              <label class="flex items-center gap-2 text-sm"><input type="radio" name="pf_gender" value="male"/> Male</label>
              <label class="flex items-center gap-2 text-sm"><input type="radio" name="pf_gender" value="female"/> Female</label>
              <label class="flex items-center gap-2 text-sm"><input type="radio" name="pf_gender" value="other"/> Other</label>
            </div>
          </div>
        </div>
        <div class="mt-6 flex gap-3 justify-end">
          <button class="px-4 py-2 rounded-xl bg-white border border-slate-200 text-slate-700 hover:bg-slate-50" onclick="closeProfile()">Cancel</button>
          <button class="px-4 py-2 rounded-xl bg-gradient-to-r from-blue-600 to-indigo-600 text-white hover:from-blue-700 hover:to-indigo-700" onclick="saveProfile()">Save</button>
        </div>
      </div>
    </div>
        <div id="modalBody" class="grid gap-4"></div>
        <div class="mt-6 flex gap-3 justify-end">
          <button class="px-4 py-2 rounded-xl bg-white border border-slate-200 text-slate-700 hover:bg-slate-50" onclick="resetModuleTimes()">Reset</button>
          <button class="px-4 py-2 rounded-xl bg-gradient-to-r from-blue-600 to-indigo-600 text-white hover:from-blue-700 hover:to-indigo-700" onclick="saveModuleTimes()">Save</button>
        </div>
      </div>
    </div>

  </main>

  <!-- FOOTER -->
  <footer class="w-full py-6 text-white btn-animated">
    <div class="max-w-5xl mx-auto px-4 flex flex-col sm:flex-row items-center justify-between gap-2 text-sm opacity-90">
      <span>Made with ‚ù§Ô∏è by Shashank Bagda</span>
      <span>Track ‚Ä¢ Improve ‚Ä¢ Evolve</span>
    </div>
  </footer>

  <!-- App Scripts -->
  <script src="js/scheduler.js"></script>
  <script src="js/app.js"></script>

  <!-- Settings modal logic -->
  <script>
    // Toasts
    const toastHost = document.createElement('div');
    toastHost.className = 'fixed z-50 top-4 right-4 space-y-2';
    document.addEventListener('DOMContentLoaded', ()=> document.body.appendChild(toastHost));
    function showToast(message, type='info'){
      const el = document.createElement('div');
      const colors = { info:'bg-slate-800', success:'bg-emerald-600', error:'bg-rose-600'};
      el.className = `${colors[type]||colors.info} text-white px-4 py-2 rounded-lg shadow text-sm animate-in`;
      el.textContent = message;
      toastHost.appendChild(el);
      setTimeout(()=>{ el.classList.add('opacity-0'); el.style.transition='opacity .4s'; }, 2000);
      setTimeout(()=> toastHost.removeChild(el), 2500);
    }
    window.showToast = showToast;
    // Profile helpers
    function getProfile(){ return JSON.parse(localStorage.getItem('userProfile')||'null'); }
    function setProfile(p){ localStorage.setItem('userProfile', JSON.stringify(p)); }

    function renderWelcome(){
      const p = getProfile();
      const w = document.getElementById('welcomeText');
      const g = document.getElementById('genderSketch');
      if (p && p.name) w.textContent = `Welcome, ${p.name}`; else w.textContent = 'Welcome';
      const em = (!p||!p.gender)?'üë§':(p.gender==='male'?'üë®':'üë©');
      g.textContent = em;
    }

    function openProfile(){ document.getElementById('profileModal').classList.remove('hidden'); }
    function closeProfile(){ document.getElementById('profileModal').classList.add('hidden'); }
    function saveProfile(){
      const name = document.getElementById('pf_name').value.trim();
      const birth = (document.getElementById('pf_birth')||{}).value||'';
      const height = parseFloat(document.getElementById('pf_height').value||'0');
      const weight = parseFloat(document.getElementById('pf_weight').value||'0');
      const gender = (document.querySelector('input[name="pf_gender"]:checked')||{}).value || 'other';
      let age = 0; if (birth) { const b=new Date(birth); const n=new Date(); age = n.getFullYear()-b.getFullYear(); const m=n.getMonth()-b.getMonth(); if (m<0||(m===0&&n.getDate()<b.getDate())) age--; }
      setProfile({ name, birth, age, height, weight, gender });
      renderWelcome();
      closeProfile();
      showToast('Profile saved','success');
    }
    window.saveProfile = saveProfile; window.closeProfile = closeProfile;

    
    // Alerts chart ‚Äì bar by module
    let alertChart;
    function getAlerts(){ return JSON.parse(localStorage.getItem('alertCounts')||'[]'); }
    const MODULES=['exercise','food','water','work','sleep'];
    function rangeStart(range){ if(range==='daily'){const d=new Date();d.setHours(0,0,0,0);return d;} if(range==='weekly'){const d=new Date();d.setDate(d.getDate()-6);d.setHours(0,0,0,0);return d;} if(range==='monthly'){const d=new Date();d.setDate(d.getDate()-29);d.setHours(0,0,0,0);return d;} return null; }
    function buildChart(){
      const range=(document.getElementById('rangeSelect')||{}).value||'daily';
      const start=rangeStart(range); const arr=getAlerts().filter(a=>!start||new Date(a.ts)>=start);
      const counts=MODULES.map(m=>arr.filter(a=>a.module===m).length);
      const ctx=document.getElementById('alertChart'); if(!ctx) return;
      const cfg={ type:'bar', data:{ labels: MODULES.map(m=>m[0].toUpperCase()+m.slice(1)), datasets:[{ label:'Alerts sent', data: counts, backgroundColor:['#10b981','#f59e0b','#38bdf8','#6366f1','#ef4444'] }]}, options:{ responsive:true, plugins:{legend:{display:false}}, scales:{ y:{beginAtZero:true,ticks:{precision:0}}}} };
      if(alertChart){ alertChart.data.labels=cfg.data.labels; alertChart.data.datasets[0].data=counts; alertChart.update(); } else { alertChart=new Chart(ctx,cfg); }
    }
document.addEventListener('DOMContentLoaded', ()=>{
      // Motivational quote
      const quotes=['Health is the greatest wealth.','Small steps every day lead to big results.','Hydrate, move, rest ‚Äî repeat.','Consistency beats intensity.','Your future self will thank you.'];
      const qb=document.getElementById('quoteBox'); if(qb) qb.textContent=quotes[Math.floor(Math.random()*quotes.length)];
      // Init profile
      const p = getProfile();
      if (!p) openProfile();
      else renderWelcome();
      // Edit button
      const eb = document.getElementById('editProfileBtn'); if (eb) eb.addEventListener('click', ()=>{
        const p=getProfile()||{}; document.getElementById('pf_name').value=p.name||''; const bd=document.getElementById('pf_birth'); if(bd) bd.value=p.birth||''; document.getElementById('pf_height').value=p.height||''; document.getElementById('pf_weight').value=p.weight||''; if (p.gender) { const r=document.querySelector(`input[name=pf_gender][value=${p.gender}]`); if(r) r.checked=true; } openProfile();
      });
      // Chart
      const rs = document.getElementById('rangeSelect'); if (rs) rs.addEventListener('change', buildChart);
      buildChart();
      window.addEventListener('alert-fired', buildChart);
    });
    const defaultTimes = {
      exercise: { ex_morning: "08:00", ex_gym: "18:30", ex_shake: "20:00" },
      food: { fd_breakfast: "08:30", fd_lunch: "13:00", fd_snack: "16:30", fd_dinner: "21:00" },
      water:{ wt_1:"08:15", wt_2:"10:30", wt_3:"13:15", wt_4:"16:00", wt_5:"19:00" },
      work: { wk_start: "09:00", wk_break: "11:00", wk_focus: "14:00", wk_wrap: "17:00" },
      sleep:{ sl_wind:"23:00", sl_brush:"23:30", sl_sleep:"00:00" }
    };

    function getTimes() {
      return JSON.parse(localStorage.getItem('reminderTimes')) || defaultTimes;
    }
    function setTimes(data) {
      localStorage.setItem('reminderTimes', JSON.stringify(data));
    }

    function getWebhookLinks(){
      return JSON.parse(localStorage.getItem('webhookLinks')||'{}');
    }
    function setWebhookLinks(obj){
      localStorage.setItem('webhookLinks', JSON.stringify(obj||{}));
    }

    let currentModule = null;

    function inputField(id, label, value) {
      const v = typeof value === 'object' ? (value.t||'') : (value||'');
      const dset = (value && value.d) ? value.d : [0,1,2,3,4,5,6];
      const dayBtn = (i, txt) => `<button type="button" data-day="${i}" data-for="${id}" class="day-btn px-2 py-1 rounded border ${dset.includes(i)?'bg-blue-600 text-white border-blue-600':'bg-white text-slate-700 border-slate-300'}">${txt}</button>`;
      const row = ['S','M','T','W','T','F','S'].map((t,i)=>dayBtn(i,t)).join(' ');
      return `<div>
        <label class="text-gray-600 text-sm">${label}</label>
        <input type="time" id="${id}" value="${v}" class="w-full bg-white border border-slate-300 rounded-lg px-3 py-2"/>
        <div class="mt-2 flex gap-1 flex-wrap">${row}</div>
      </div>`;
    }

    const moduleFields = {
      exercise: [
        ['ex_morning','Morning Mobility'],
        ['ex_gym','Gym / Swimming'],
        ['ex_shake','Protein Shake']
      ],
      food: [
        ['fd_breakfast','Breakfast'],
        ['fd_lunch','Lunch'],
        ['fd_snack','Snack'],
        ['fd_dinner','Dinner']
      ],
      water: [
        ['wt_1','Morning'], ['wt_2','Mid-Morning'], ['wt_3','After Lunch'], ['wt_4','Evening'], ['wt_5','Pre-Workout']
      ],
      work: [
        ['wk_start','Start'], ['wk_break','Break'], ['wk_focus','Refocus'], ['wk_wrap','Wrap']
      ],
      sleep: [
        ['sl_wind','Wind Down'], ['sl_brush','Brush Teeth'], ['sl_sleep','Sleep Time']
      ]
    };

    function titleFor(mod){
      return {
        exercise:'üèãÔ∏è Exercise Times', food:'üçΩ Food Times', water:'üíß Water Times', work:'üíª Work Times', sleep:'üò¥ Sleep Times'
      }[mod] || 'Edit Times';
    }

    function openSettings(mod) {
      currentModule = mod;
      const times = getTimes();
      const body = document.getElementById('modalBody');
      document.getElementById('modalTitle').textContent = titleFor(mod);
      const fields = moduleFields[mod];
      const hooks = getWebhookLinks();
      const hookVal = hooks[mod] || '';
      body.innerHTML = `
        ${fields.map(([id,label]) => inputField(id,label, (times[mod]||defaultTimes[mod])[id])).join('')}
        <div class="mt-2">
          <label class="text-gray-600 text-sm">Webhook URL (optional)</label>
          <input type="url" id="webhook_url" placeholder="https://..." value="${hookVal}"
                 class="w-full bg-white border border-slate-300 rounded-lg px-3 py-2"/>
        </div>`;
      document.getElementById('settingsModal').classList.remove('hidden');
      document.querySelectorAll('.day-btn').forEach(btn=>{
        btn.addEventListener('click',()=>{
          const on = btn.classList.contains('bg-blue-600');
          btn.classList.toggle('bg-blue-600', !on);
          btn.classList.toggle('text-white', !on);
          btn.classList.toggle('border-blue-600', !on);
          btn.classList.toggle('bg-white', on);
          btn.classList.toggle('text-slate-700', on);
          btn.classList.toggle('border-slate-300', on);
        });
      });
    }
    function closeSettings(){
      document.getElementById('settingsModal').classList.add('hidden');
      currentModule = null;
    }
    function saveModuleTimes(){
      if (!currentModule) return;
      const times = getTimes();
      const updates = {};
      moduleFields[currentModule].forEach(([id]) => {
        const timeVal = document.getElementById(id).value;
        const days = Array.from(document.querySelectorAll(`.day-btn[data-for="${id}"]`))
          .filter(b=>b.classList.contains('bg-blue-600'))
          .map(b=>parseInt(b.getAttribute('data-day')));
        updates[id] = { t: timeVal, d: days.length?days:[0,1,2,3,4,5,6] };
      });
      times[currentModule] = updates;
      setTimes(times);
      const hooks = getWebhookLinks();
      const newHook = (document.getElementById('webhook_url')||{}).value || '';
      hooks[currentModule] = newHook;
      setWebhookLinks(hooks);
      // Re-init only this module if enabled
      const enabled = new Set(JSON.parse(localStorage.getItem('enabledWorkers')||'[]'));
      if (enabled.has(currentModule)) { stopWorker(currentModule,{silent:true}); startWorker(currentModule,{silent:true}); }
      closeSettings();
      if (window.showToast) showToast('Saved!', 'success');
    }
    function resetModuleTimes(){
      if (!currentModule) return;
      const times = getTimes();
      times[currentModule] = defaultTimes[currentModule];
      setTimes(times);
      const hooks = getWebhookLinks();
      delete hooks[currentModule];
      setWebhookLinks(hooks);
      openSettings(currentModule); // re-render
      if (window.showToast) showToast('Reset to defaults', 'info');
    }
    // expose for buttons
    window.openSettings = openSettings;
    window.closeSettings = closeSettings;
    window.saveModuleTimes = saveModuleTimes;
    window.resetModuleTimes = resetModuleTimes;
  </script>

</body>
</html>
