<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lifestyle Tracker App</title>

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Styles -->
  <style>
    body { background: #f7f8fb; font-family: 'Inter', sans-serif; }
    .glass { backdrop-filter: blur(15px); background: rgba(255,255,255,.7); border: 1px solid rgba(255,255,255,.5); box-shadow: 0 10px 30px rgba(2,6,23,.08); }
    .toggle-on { background: #10b981 !important; color: #fff !important; }
    .toggle-off { background: #e2e8f0 !important; color: #475569 !important; }
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(12px);} to { opacity: 1; transform: translateY(0);} }
    .animate-in { animation: fadeInUp .5s ease both; }
    @keyframes gradientX { 0% { background-position: 0% 50%; } 100% { background-position: 100% 50%; } }
    .btn-animated { background: linear-gradient(90deg,#3b82f6,#10b981,#8b5cf6); background-size:200% 100%; animation: gradientX 4s ease infinite alternate; color:#fff; }
  </style>

  <!-- PWA Manifest -->
  <link rel="manifest" href="pwa/manifest.json" />
</head>

<script>
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("pwa/service-worker.js");
  }
</script>

<body class="min-h-screen flex flex-col">

  <!-- HEADER -->
  <header class="w-full py-4 bg-gradient-to-r from-blue-600 via-emerald-500 to-indigo-600 text-white shadow">
    <div class="max-w-5xl mx-auto px-4 flex items-center">
      <img src="assets/icon-192.png" alt="" class="w-8 h-8 rounded mr-3" />
      <h1 class="text-xl md:text-2xl font-semibold">Shashank's Lifestyle Tracker</h1>
    </div>
  </header>

  <main class="flex-1 px-4 md:px-8 lg:px-12 py-8 space-y-10">

    <!-- REMINDER MODULES (kept from dashboard) -->
    <section class="max-w-5xl mx-auto animate-in">
      <h2 class="text-xl font-semibold text-gray-700 mb-4">Reminder Modules</h2>
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">

        <!-- Exercise -->
        <div class="glass p-4 rounded-xl shadow flex flex-col justify-between">
          <div class="flex items-center justify-between">
            <div>
              <h3 class="text-lg font-semibold text-gray-700">üèãÔ∏è Exercise</h3>
              <p class="text-gray-500 text-sm">Gym + mobility reminders</p>
            </div>
            <button aria-label="Edit times" title="Edit times" class="p-2 rounded-md bg-white border border-slate-200 shadow hover:bg-slate-50" onclick="openSettings('exercise')">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-700" viewBox="0 0 20 20" fill="currentColor"><path d="M11.983 1.883a1 1 0 00-1.966 0l-.094.564a7.034 7.034 0 00-1.387.803l-.51-.295a1 1 0 00-1.366.366l-1 1.732a1 1 0 00.366 1.366l.51.295a7.034 7.034 0 00-.2 1.597 7.034 7.034 0 00.2 1.597l-.51.295a1 1 0 00-.366 1.366l1 1.732a1 1 0 001.366.366l.51-.295c.43.326.894.597 1.387.803l.094.564a1 1 0 001.966 0l.094-.564c.493-.206.957-.477 1.387-.803l.51.295a1 1 0 001.366-.366l1-1.732a1 1 0 00-.366-1.366l-.51-.295a7.034 7.034 0 00.2-1.597 7.034 7.034 0 00-.2-1.597l.51-.295a1 1 0 00.366-1.366l-1-1.732a1 1 0 00-1.366-.366l-.51.295a7.034 7.034 0 00-1.387-.803l-.094-.564zM10 13a3 3 0 110-6 3 3 0 010 6z"/></svg>
            </button>
          </div>
          <div class="flex gap-2 mt-4">
            <button id="toggle-exercise" class="flex-1 py-2 rounded-lg toggle-off font-medium shadow">Enable</button>
            <button type="button" onclick="window.testWebhook('exercise')" class="px-3 py-2 rounded-lg shadow btn-animated">Test</button>
          </div>
        </div>

        <!-- Food -->
        <div class="glass p-4 rounded-xl shadow flex flex-col justify-between">
          <div class="flex items-center justify-between">
            <div>
              <h3 class="text-lg font-semibold text-gray-700">üçΩ Food</h3>
              <p class="text-gray-500 text-sm">Breakfast, lunch, dinner reminders</p>
            </div>
            <button aria-label="Edit times" title="Edit times" class="p-2 rounded-md bg-white border border-slate-200 shadow hover:bg-slate-50" onclick="openSettings('food')">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-700" viewBox="0 0 20 20" fill="currentColor"><path d="M11.983 1.883a1 1 0 00-1.966 0l-.094.564a7.034 7.034 0 00-1.387.803l-.51-.295a1 1 0 00-1.366.366l-1 1.732a1 1 0 00.366 1.366l.51.295a7.034 7.034 0 00-.2 1.597 7.034 7.034 0 00-.2 1.597l-.51.295a1 1 0 00-.366 1.366l1 1.732a1 1 0 001.366.366l.51-.295c.43.326.894.597 1.387.803l.094.564a1 1 0 001.966 0l.094-.564c.493-.206.957-.477 1.387-.803l.51.295a1 1 0 001.366-.366l1-1.732a1 1 0 00-.366-1.366l-.51-.295a7.034 7.034 0 00.2-1.597 7.034 7.034 0 00-.2-1.597l.51-.295a1 1 0 00.366-1.366l-1-1.732a1 1 0 00-1.366-.366l-.51.295a7.034 7.034 0 00-1.387-.803l-.094-.564zM10 13a3 3 0 110-6 3 3 0 010 6z"/></svg>
            </button>
          </div>
          <div class="flex gap-2 mt-4">
            <button id="toggle-food" class="flex-1 py-2 rounded-lg toggle-off font-medium shadow">Enable</button>
            <button type="button" onclick="window.testWebhook('food')" class="px-3 py-2 rounded-lg shadow btn-animated">Test</button>
          </div>
        </div>

        <!-- Water -->
        <div class="glass p-4 rounded-xl shadow flex flex-col justify-between">
          <div class="flex items-center justify-between">
            <div>
              <h3 class="text-lg font-semibold text-gray-700">üíß Water</h3>
              <p class="text-gray-500 text-sm">Hydration reminders throughout day</p>
            </div>
            <button aria-label="Edit times" title="Edit times" class="p-2 rounded-md bg-white border border-slate-200 shadow hover:bg-slate-50" onclick="openSettings('water')">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-700" viewBox="0 0 20 20" fill="currentColor"><path d="M11.983 1.883a1 1 0 00-1.966 0l-.094.564a7.034 7.034 0 00-1.387.803l-.51-.295a1 1 0 00-1.366.366l-1 1.732a1 1 0 00.366 1.366l.51.295a7.034 7.034 0 00-.2 1.597 7.034 7.034 0 00-.2 1.597l-.51.295a1 1 0 00-.366 1.366l1 1.732a1 1 0 001.366.366l.51-.295c.43.326.894.597 1.387.803l.094.564a1 1 0 001.966 0l.094-.564c.493-.206.957-.477 1.387-.803l.51.295a1 1 0 001.366-.366l1-1.732a1 1 0 00-.366-1.366l-.51-.295a7.034 7.034 0 00.2-1.597 7.034 7.034 0 00-.2-1.597l.51-.295a1 1 0 00.366-1.366l-1-1.732a1 1 0 00-1.366-.366l-.51.295a7.034 7.034 0 00-1.387-.803l-.094-.564zM10 13a3 3 0 110-6 3 3 0 010 6z"/></svg>
            </button>
          </div>
          <div class="flex gap-2 mt-4">
            <button id="toggle-water" class="flex-1 py-2 rounded-lg toggle-off font-medium shadow">Enable</button>
            <button type="button" onclick="window.testWebhook('water')" class="px-3 py-2 rounded-lg shadow btn-animated">Test</button>
          </div>
        </div>

        <!-- Work -->
        <div class="glass p-4 rounded-xl shadow flex flex-col justify-between">
          <div class="flex items-center justify-between">
            <div>
              <h3 class="text-lg font-semibold text-gray-700">üíª Work</h3>
              <p class="text-gray-500 text-sm">Productivity + focus reminders</p>
            </div>
            <button aria-label="Edit times" title="Edit times" class="p-2 rounded-md bg-white border border-slate-200 shadow hover:bg-slate-50" onclick="openSettings('work')">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-700" viewBox="0 0 20 20" fill="currentColor"><path d="M11.983 1.883a1 1 0 00-1.966 0l-.094.564a7.034 7.034 0 00-1.387.803l-.51-.295a1 1 0 00-1.366.366l-1 1.732a1 1 0 00.366 1.366l.51.295a7.034 7.034 0 00-.2 1.597 7.034 7.034 0 00-.2 1.597l-.51.295a1 1 0 00-.366 1.366l1 1.732a1 1 0 001.366.366l.51-.295c.43.326.894.597 1.387.803l.094.564a1 1 0 001.966 0l.094-.564c.493-.206.957-.477 1.387-.803l.51.295a1 1 0 001.366-.366l1-1.732a1 1 0 00-.366-1.366l-.51-.295a7.034 7.034 0 00.2-1.597 7.034 7.034 0 00-.2-1.597l.51-.295a1 1 0 00.366-1.366l-1-1.732a1 1 0 00-1.366-.366l-.51.295a7.034 7.034 0 00-1.387-.803l-.094-.564zM10 13a3 3 0 110-6 3 3 0 010 6z"/></svg>
            </button>
          </div>
          <div class="flex gap-2 mt-4">
            <button id="toggle-work" class="flex-1 py-2 rounded-lg toggle-off font-medium shadow">Enable</button>
            <button type="button" onclick="window.testWebhook('work')" class="px-3 py-2 rounded-lg shadow btn-animated">Test</button>
          </div>
        </div>

        <!-- Sleep -->
        <div class="glass p-4 rounded-xl shadow flex flex-col justify-between">
          <div class="flex items-center justify-between">
            <div>
              <h3 class="text-lg font-semibold text-gray-700">üò¥ Sleep</h3>
              <p class="text-gray-500 text-sm">Sleep routine + wind-down reminders</p>
            </div>
            <button aria-label="Edit times" title="Edit times" class="p-2 rounded-md bg-white border border-slate-200 shadow hover:bg-slate-50" onclick="openSettings('sleep')">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-700" viewBox="0 0 20 20" fill="currentColor"><path d="M11.983 1.883a1 1 0 00-1.966 0l-.094.564a7.034 7.034 0 00-1.387.803l-.51-.295a1 1 0 00-1.366.366l-1 1.732a1 1 0 00.366 1.366l.51.295a7.034 7.034 0 00-.2 1.597 7.034 7.034 0 00-.2 1.597l-.51.295a1 1 0 00-.366 1.366l1 1.732a1 1 0 001.366.366l.51-.295c.43 .326.894.597 1.387.803l.094.564a1 1 0 001.966 0l.094-.564c.493-.206.957-.477 1.387-.803l.51.295a1 1 0 001.366-.366l1-1.732a1 1 0 00-.366-1.366l-.51-.295a7.034 7.034 0 00.2-1.597 7.034 7.034 0 00-.2-1.597l.51-.295a1 1 0 00.366-1.366l-1-1.732a1 1 0 00-1.366-.366l-.51.295a7.034 7.034 0 00-1.387-.803l-.094-.564zM10 13a3 3 0 110-6 3 3 0 010 6z"/></svg>
            </button>
          </div>
          <div class="flex gap-2 mt-4">
            <button id="toggle-sleep" class="flex-1 py-2 rounded-lg toggle-off font-medium shadow">Enable</button>
            <button type="button" onclick="window.testWebhook('sleep')" class="px-3 py-2 rounded-lg shadow btn-animated">Test</button>
          </div>
        </div>

      </div>
    </section>

    <!-- Settings Modal (per-module) -->
    <div id="settingsModal" class="fixed inset-0 z-50 hidden">
      <div class="absolute inset-0 bg-slate-900/40" onclick="closeSettings()"></div>
      <div class="relative max-w-xl mx-auto mt-24 glass rounded-2xl p-6 animate-in">
        <div class="flex items-center justify-between mb-3">
          <h3 id="modalTitle" class="text-lg font-semibold text-gray-800">Edit Times</h3>
          <button class="p-2 rounded-lg hover:bg-slate-100" onclick="closeSettings()">‚úñ</button>
        </div>
        <div id="modalBody" class="grid gap-4"></div>
        <div class="mt-6 flex gap-3 justify-end">
          <button class="px-4 py-2 rounded-xl bg-white border border-slate-200 text-slate-700 hover:bg-slate-50" onclick="resetModuleTimes()">Reset</button>
          <button class="px-4 py-2 rounded-xl bg-gradient-to-r from-blue-600 to-indigo-600 text-white hover:from-blue-700 hover:to-indigo-700" onclick="saveModuleTimes()">Save</button>
        </div>
      </div>
    </div>

  </main>

  <!-- FOOTER -->
  <footer class="w-full py-6 bg-gradient-to-r from-indigo-600 via-emerald-500 to-blue-600 text-white">
    <div class="max-w-5xl mx-auto px-4 flex flex-col sm:flex-row items-center justify-between gap-2 text-sm opacity-90">
      <span>Made with ‚ù§Ô∏è by Shashank Bagda</span>
      <span>Track ‚Ä¢ Improve ‚Ä¢ Evolve</span>
    </div>
  </footer>

  <!-- App Scripts -->
  <script src="js/scheduler.js"></script>
  <script src="js/app.js"></script>

  <!-- Settings modal logic -->
  <script>
    // Toasts
    const toastHost = document.createElement('div');
    toastHost.className = 'fixed z-50 top-4 right-4 space-y-2';
    document.addEventListener('DOMContentLoaded', ()=> document.body.appendChild(toastHost));
    function showToast(message, type='info'){
      const el = document.createElement('div');
      const colors = { info:'bg-slate-800', success:'bg-emerald-600', error:'bg-rose-600'};
      el.className = `${colors[type]||colors.info} text-white px-4 py-2 rounded-lg shadow text-sm animate-in`;
      el.textContent = message;
      toastHost.appendChild(el);
      setTimeout(()=>{ el.classList.add('opacity-0'); el.style.transition='opacity .4s'; }, 2000);
      setTimeout(()=> toastHost.removeChild(el), 2500);
    }
    window.showToast = showToast;
    const defaultTimes = {
      exercise: { ex_morning: "08:00", ex_gym: "18:30", ex_shake: "20:00" },
      food: { fd_breakfast: "08:30", fd_lunch: "13:00", fd_snack: "16:30", fd_dinner: "21:00" },
      water:{ wt_1:"08:15", wt_2:"10:30", wt_3:"13:15", wt_4:"16:00", wt_5:"19:00" },
      work: { wk_start: "09:00", wk_break: "11:00", wk_focus: "14:00", wk_wrap: "17:00" },
      sleep:{ sl_wind:"23:00", sl_brush:"23:30", sl_sleep:"00:00" }
    };

    function getTimes() {
      return JSON.parse(localStorage.getItem('reminderTimes')) || defaultTimes;
    }
    function setTimes(data) {
      localStorage.setItem('reminderTimes', JSON.stringify(data));
    }

    let currentModule = null;

    function inputField(id, label, value) {
      return `<div><label class="text-gray-600 text-sm">${label}</label><input type="time" id="${id}" value="${value}" class="w-full bg-white border border-slate-300 rounded-lg px-3 py-2"/></div>`;
    }

    const moduleFields = {
      exercise: [
        ['ex_morning','Morning Mobility'],
        ['ex_gym','Gym / Swimming'],
        ['ex_shake','Protein Shake']
      ],
      food: [
        ['fd_breakfast','Breakfast'],
        ['fd_lunch','Lunch'],
        ['fd_snack','Snack'],
        ['fd_dinner','Dinner']
      ],
      water: [
        ['wt_1','Morning'], ['wt_2','Mid-Morning'], ['wt_3','After Lunch'], ['wt_4','Evening'], ['wt_5','Pre-Workout']
      ],
      work: [
        ['wk_start','Start'], ['wk_break','Break'], ['wk_focus','Refocus'], ['wk_wrap','Wrap']
      ],
      sleep: [
        ['sl_wind','Wind Down'], ['sl_brush','Brush Teeth'], ['sl_sleep','Sleep Time']
      ]
    };

    function titleFor(mod){
      return {
        exercise:'üèãÔ∏è Exercise Times', food:'üçΩ Food Times', water:'üíß Water Times', work:'üíª Work Times', sleep:'üò¥ Sleep Times'
      }[mod] || 'Edit Times';
    }

    function openSettings(mod) {
      currentModule = mod;
      const times = getTimes();
      const body = document.getElementById('modalBody');
      document.getElementById('modalTitle').textContent = titleFor(mod);
      const fields = moduleFields[mod];
      body.innerHTML = fields.map(([id,label]) => inputField(id,label, (times[mod]||defaultTimes[mod])[id])).join('');
      document.getElementById('settingsModal').classList.remove('hidden');
    }
    function closeSettings(){
      document.getElementById('settingsModal').classList.add('hidden');
      currentModule = null;
    }
    function saveModuleTimes(){
      if (!currentModule) return;
      const times = getTimes();
      const updates = {};
      moduleFields[currentModule].forEach(([id]) => { updates[id] = document.getElementById(id).value; });
      times[currentModule] = updates;
      setTimes(times);
      // Re-init only this module if enabled
      const enabled = new Set(JSON.parse(localStorage.getItem('enabledWorkers')||'[]'));
      if (enabled.has(currentModule)) { stopWorker(currentModule); startWorker(currentModule); }
      closeSettings();
      alert('Saved!');
    }
    function resetModuleTimes(){
      if (!currentModule) return;
      const times = getTimes();
      times[currentModule] = defaultTimes[currentModule];
      setTimes(times);
      openSettings(currentModule); // re-render
    }
    // expose for buttons
    window.openSettings = openSettings;
    window.closeSettings = closeSettings;
    window.saveModuleTimes = saveModuleTimes;
    window.resetModuleTimes = resetModuleTimes;
  </script>

</body>
</html>
